<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Sideloaded HTTP Exchanges</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 550px);
    width: 300px;
    z-index: 1;
  }
  #rfc\.toc {
    top: 55px;
    overflow: auto;
    overscroll-behavior: contain;
  }
  ul.toc, #rfc\.toc {
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>ul.toc {
    top: 140px;
  }

  body {
    padding-right: 350px;
  }
}

body {
  font: 16px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 36px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 18px;
  line-height: 27px%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Side-loading an exchange">
<link href="#rfc.section.3" rel="Chapter" title="3 Validating a claimed exchange">
<link href="#rfc.section.4" rel="Chapter" title="4 An origin&#8217;s signing key">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Confidential data">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Downgrades">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Unsigned headers">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Invalid TLS certificates">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Stolen private keys">
<link href="#rfc.section.6" rel="Chapter" title="6 Privacy Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Why didn&#8217;t you &#8230;">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Trust integrity attributes">
<link href="#rfc.appendix.B" rel="Chapter" title="B Related work">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.2 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Yasskin, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-yasskin-httpbis-sideloaded-exchanges-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-02-14" />
  <meta name="dct.abstract" content="This document specifies how a server can provide an HTTP request/response pair (an exchange) for another origin. The client verifies the exchange using a public key fetched from the claimed origin." />
  <meta name="description" content="This document specifies how a server can provide an HTTP request/response pair (an exchange) for another origin. The client verifies the exchange using a public key fetched from the claimed origin." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J. Yasskin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Google Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">February 14, 2018</td>
</tr>
<tr>
<td class="left">Expires: August 18, 2018</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Sideloaded HTTP Exchanges<br />
  <span class="filename">draft-yasskin-httpbis-sideloaded-exchanges-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies how a server can provide an HTTP request/response pair (an exchange) for another origin. The client verifies the exchange using a public key fetched from the claimed origin.</p>
<h1><a>Note to Readers</a></h1>
<p>Discussion of this draft takes place on the HTTP working group mailing list (ietf-http-wg@w3.org), which is archived at <a href="https://lists.w3.org/Archives/Public/ietf-http-wg/">https://lists.w3.org/Archives/Public/ietf-http-wg/</a>.</p>
<p>The source code and issues list for this draft can be found in <a href="https://github.com/jyasskin/sideloaded-exchanges">https://github.com/jyasskin/sideloaded-exchanges</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 18, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Side-loading an exchange</a>
</li>
<li>3.   <a href="#rfc.section.3">Validating a claimed exchange</a>
</li>
<li>4.   <a href="#rfc.section.4">An origin&#8217;s signing key</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Confidential data</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Downgrades</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Unsigned headers</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Invalid TLS certificates</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Stolen private keys</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Privacy Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Why didn&#8217;t you &#8230;</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Trust integrity attributes</a>
</li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Related work</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Some clients have expensive data connections and would prefer to transfer the data needed for a web application from a nearby peer instead of via the public internet. These clients can usually afford to transfer small amounts of data, which this specification uses to validate the data received from the peer.  However, those clients often have mobile data manually turned off, which will prevent even this small amount of validation data from being transferred.</p>
<p id="rfc.section.1.p.2">This draft refers to several components from <a href="#I-D.yasskin-http-origin-signed-responses" class="xref">[I-D.yasskin-http-origin-signed-responses]</a>, but if this draft is accepted and that one isn&#8217;t, those components can be moved here.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;NOT RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#side-loading" id="side-loading">Side-loading an exchange</a>
</h1>
<p id="rfc.section.2.p.1">An HTTP exchange can be stored in an <samp>application/http-exchange+cbor</samp> resource, as defined in <a href="#I-D.yasskin-http-origin-signed-responses" class="xref">[I-D.yasskin-http-origin-signed-responses]</a>. When a client loads this resource, it SHOULD record a claim that the origin server replies to the wrapped request with the wrapped response. It MUST NOT store this pairing in the normal HTTP cache (<a href="#RFC7234" class="xref">[RFC7234]</a>) without further validating it (<a href="#exchange-validation" class="xref">Section 3</a>).</p>
<p id="rfc.section.2.p.2">The client MUST NOT validate a side-loaded exchange until its person indicates some intention to visit the contained URL. See <a href="#privacy" class="xref">Section 6</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#exchange-validation" id="exchange-validation">Validating a claimed exchange</a>
</h1>
<p id="rfc.section.3.p.1">When a client attempts to navigate to a URL for which it has a side-loaded exchange (<a href="#side-loading" class="xref">Section 2</a>), it MUST run the following steps to determine whether to use the side-loaded response. If the steps return an exchange, the client MUST use that exchange without fetching the URL itself. If they return <samp>null</samp>, the client MUST fetch the URL over the network.</p>
<p></p>

<ol>
<li>Let <samp>publicKey</samp> be the origin&#8217;s signing key, determined by <a href="#signing-key" class="xref">Section 4</a>.  If the client can&#8217;t determine a signing key for the origin, return <samp>null</samp>.</li>
<li>Parse the side-loaded response&#8217;s <samp>Signature</samp> header field into a list as described by <a href="#I-D.yasskin-http-origin-signed-responses" class="xref">[I-D.yasskin-http-origin-signed-responses]</a>, and validate the subset with <samp>ed25519Key</samp> properties matching <samp>publicKey</samp>, with the <samp>allResponseHeaders</samp> flag set.</li>
<li>If the validation procedure for any of these list elements returns &#8220;potentially-valid&#8221; with an <samp>exchange</samp> and <samp>publicKey</samp>, return <samp>exchange</samp>.  Otherwise, return <samp>null</samp>.</li>
</ol>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#signing-key" id="signing-key">An origin&#8217;s signing key</a>
</h1>
<p id="rfc.section.4.p.1">The <a href="https://wicg.github.io/origin-policy/#origin-policy-manifest">origin policy manifest</a> concept defined by <a href="#OriginPolicy" class="xref">[OriginPolicy]</a> is extended with a &#8220;signingKey&#8221; member whose value is a JSON object matching the following CDDL (Appendix E.1 of <a href="#I-D.ietf-cbor-cddl" class="xref">[I-D.ietf-cbor-cddl]</a>):</p>
<pre>
signingKey = {
  ed25519: tstr,
  expires: tstr,
  * tstr =&gt; any
}
</pre>
<p><samp>ed25519</samp> is interpreted as a base64 string with padding omitted (Section 4 of <a href="#RFC4648" class="xref">[RFC4648]</a>), encoding a 32-byte Ed25519 public key. If it&#8217;s not present, has characters not from the base64 alphabet, or is not 43 characters long, it is invalid.</p>
<p><samp>expires</samp> is interpreted as an <a href="#RFC3339" class="xref">[RFC3339]</a> date-time in which the &#8220;T&#8221; MUST be uppercase, the time-secfrac MUST NOT be present, and the time-offset MUST be an uppercase &#8220;Z&#8221;. If these requirements aren&#8217;t satisfied, the member MUST be treated as not present. If the <samp>expires</samp> member is not present, in the past, or more than 604800 seconds (7 days) in the future, it is invalid.</p>
<p id="rfc.section.4.p.4">To determine an origin&#8217;s signing key, the client MUST run the following steps:</p>
<p></p>

<ol>
<li>Let <samp>keyInfo</samp> be <samp>null</samp>.</li>
<li>If the <a href="https://wicg.github.io/origin-policy/#abstract-opdef-retrieve-an-origin-policy-for-an-origin">&#8220;retrieve an Origin Policy for an origin&#8221;</a> operation defined in <a href="#OriginPolicy" class="xref">[OriginPolicy]</a> returns an origin policy object, and the origin policy object&#8217;s body has a &#8220;signingKey&#8221; member, set <samp>keyInfo</samp> to the value of that member.</li>
<li>If the above origin policy was transferred over a connection guarded by a TLS certificate, and that certificate has expired or been revoked, set <samp>keyInfo</samp> back to <samp>null</samp>.</li>
<li>If <samp>keyInfo</samp> isn&#8217;t <samp>null</samp>, but its <samp>ed25519</samp> member or <samp>expires</samp> member is invalid (see above), set <samp>keyInfo</samp> back to <samp>null</samp>.</li>
<li>If <samp>keyInfo</samp> is <samp>null</samp>, fetch the <samp>/.well-known/origin-policy</samp> path within the origin, following redirects, parse it as an origin policy manifest, and if  that manifest&#8217;s &#8220;signingKey&#8221; member is present, set <samp>keyInfo</samp> to that member&#8217;s value. The client MAY store an appropriate tuple in its Origin Policy Store.</li>
<li>If <samp>keyInfo</samp> is <samp>null</samp> or its <samp>ed25519</samp> or <samp>expires</samp> member is invalid (see above), the origin has no signing key.</li>
<li>Otherwise, the signing key is the base64-decoded bytes from <samp>keyInfo.ed25519</samp>.</li>
</ol>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#confidential-data" id="confidential-data">Confidential data</a>
</h1>
<p id="rfc.section.5.1.p.1">Authors MUST NOT include confidential information in a signed exchange that an untrusted intermediate could side-load, since the exchange is only signed and not encrypted. Intermediates can read the content.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#downgrades" id="downgrades">Downgrades</a>
</h1>
<p id="rfc.section.5.2.p.1">Signing a bad exchange can affect more users than simply serving a bad response, since a served response will only affect users who make a request while the bad version is live, while an attacker can side-load a signed exchange until its signature or key expires. Authors SHOULD consider shorter signature expiration times than they use for cache expiration times.</p>
<p id="rfc.section.5.2.p.2">The author of an origin MAY rotate its signing key when they replace a vulnerable resource. However, this isn&#8217;t guaranteed to take effect until the old signing key expires (<a href="#signing-key" class="xref">Section 4</a>).</p>
<p id="rfc.section.5.2.p.3">Clients MAY also re-fetch an origin&#8217;s Origin Policy more often than the signing key expires, to check for such key rotation more aggressively.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#unsigned-headers" id="unsigned-headers">Unsigned headers</a>
</h1>
<p id="rfc.section.5.3.p.1">The <samp>Signature</samp> header (<a href="#I-D.yasskin-http-origin-signed-responses" class="xref">[I-D.yasskin-http-origin-signed-responses]</a>) doesn&#8217;t currently allow signing request headers (aside from the effective request URI, which is required to be signed). This means that content negotiation isn&#8217;t trustworthy, even if multiple signed exchanges are available for the same URL.</p>
<p id="rfc.section.5.3.p.2">It is also important to avoid using response headers that weren&#8217;t signed, to avoid, for example, type confusion attacks. The algorithm in <a href="#exchange-validation" class="xref">Section 3</a> requires that clients use the exchange it returns, rather than the original exchange, to avoid that risk.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#invalid-tls-certificates" id="invalid-tls-certificates">Invalid TLS certificates</a>
</h1>
<p id="rfc.section.5.4.p.1">The signing key is only trustworthy because it&#8217;s transferred over a TLS connection. If the certificate that guarded its transfer expires or is revoked, trust in the signing key MUST be revoked as well. This is specified in <a href="#signing-key" class="xref">Section 4</a> but may be difficult to implement.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#stolen-private-keys" id="stolen-private-keys">Stolen private keys</a>
</h1>
<p id="rfc.section.5.5.p.1">If the private key for the signing key is stolen, the thief can forge exchanges for side-loading. Protect your keys.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#privacy" id="privacy">Privacy Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Validating a side-loaded exchange (<a href="#exchange-validation" class="xref">Section 3</a>) reveals to that exchange&#8217;s original origin that the client has gone somewhere that gave it the exchange, and that the client may be interested in actually reading the exchange. The <samp>Referer</samp> header (Section 5.5.2 of <a href="#RFC7231" class="xref">[RFC7231]</a>) may reveal which server provided the exchange. Validating a side-loaded exchange also reveals to any network eavesdroppers (via SNI, Section 3 of <a href="#RFC6066" class="xref">[RFC6066]</a>)) that the client is interested in the origin server. This is the same information the origin and network eavesdroppers would have received if the exchange were not side-loaded and the client followed a link to it.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-cbor-cddl">[I-D.ietf-cbor-cddl]</b></td>
<td class="top">
<a>Birkholz, H.</a>, <a>Vigano, C.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/draft-ietf-cbor-cddl-01">Concise data definition language (CDDL): a notational convention to express CBOR data structures</a>", Internet-Draft draft-ietf-cbor-cddl-01, January 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.yasskin-http-origin-signed-responses">[I-D.yasskin-http-origin-signed-responses]</b></td>
<td class="top">
<a>Yasskin, J.</a>, "<a href="https://tools.ietf.org/html/draft-yasskin-http-origin-signed-responses-02">Signed HTTP Exchanges</a>", Internet-Draft draft-yasskin-http-origin-signed-responses-02, January 2018.</td>
</tr>
<tr>
<td class="reference"><b id="OriginPolicy">[OriginPolicy]</b></td>
<td class="top">
<a title="Google Inc.">West, M.</a>, "<a href="https://wicg.github.io/origin-policy/">Origin Policy</a>", Web Incubation Community Group Draft Community Group Report, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3339">[RFC3339]</b></td>
<td class="top">
<a>Klyne, G.</a> and <a>C. Newman</a>, "<a href="https://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>", RFC 3339, DOI 10.17487/RFC3339, July 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4648">[RFC4648]</b></td>
<td class="top">
<a>Josefsson, S.</a>, "<a href="https://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, DOI 10.17487/RFC4648, October 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7234">[RFC7234]</b></td>
<td class="top">
<a>Fielding, R.</a>, <a>Nottingham, M.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>", RFC 7234, DOI 10.17487/RFC7234, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="CSP">[CSP]</b></td>
<td class="top">
<a>West, M.</a>, <a>Barth, A.</a> and <a>D. Veditz</a>, "<a href="https://www.w3.org/TR/2016/REC-CSP2-20161215">Content Security Policy Level 2</a>", World Wide Web Consortium Recommendation REC-CSP2-20161215, December 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6066">[RFC6066]</b></td>
<td class="top">
<a>Eastlake 3rd, D.</a>, "<a href="https://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, DOI 10.17487/RFC6066, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7232">[RFC7232]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests</a>", RFC 7232, DOI 10.17487/RFC7232, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="SRI">[SRI]</b></td>
<td class="top">
<a>Akhawe, D.</a>, <a>Braun, F.</a>, <a>Marier, F.</a> and <a>J. Weinberger</a>, "<a href="http://www.w3.org/TR/2016/REC-SRI-20160623">Subresource Integrity</a>", World Wide Web Consortium Recommendation REC-SRI-20160623, June 2016.</td>
</tr>
<tr>
<td class="reference"><b id="SRICaching">[SRICaching]</b></td>
<td class="top">
<a title="Facebook Inc.">Hill, B.</a>, "<a href="https://hillbrad.github.io/sri-addressable-caching/sri-addressable-caching.html">Subresource Integrity Addressable Caching</a>", October 2016.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#why-didnt-you-" id="why-didnt-you-">Why didn&#8217;t you &#8230;</a>
</h1>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#trust-integrity-attributes" id="trust-integrity-attributes">Trust integrity attributes</a>
</h1>
<p><a href="#CSP" class="xref">[CSP]</a>&#8217;s threat model is that an attacker may be able to inject a <samp>&lt;script src='https://untrusted.example.com/script.js' integrity='ed25519-publickey'&gt;</samp> element, but if the <samp>Content-Security-Policy</samp> header field doesn&#8217;t include a <samp>script-src https://untrusted.example.com/</samp> directive, that script won&#8217;t execute.</p>
<p id="rfc.section.A.1.p.2">As discussed in <a href="#SRICaching" class="xref">[SRICaching]</a>, allowing that attacker to claim that <samp>https://trusted.example.com/script.js</samp> has particular content signed by a particular public key, where <samp>trusted.example.com</samp> is chosen to already be present in the resource&#8217;s <samp>script-src</samp> directive, would allow them to run arbitrary content, defeating the purpose of the <samp>Content-Security-Policy</samp> header.</p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#related-work" id="related-work">Related work</a>
</h1>
<p id="rfc.section.B.p.1">This proposal is Eric Rescorla&#8217;s counter-proposal to <a href="#I-D.yasskin-http-origin-signed-responses" class="xref">[I-D.yasskin-http-origin-signed-responses]</a>. That proposal allows trust in content from one origin but provided by another, without making a TLS connection to the original origin. This proposal attempts to serve most of the same use cases but preserves the requirement that the client, at some time in the past, made a TLS connection to the original origin.</p>
<p id="rfc.section.B.p.2">This proposal is related to proposals to cache resources with a key consisting of their <a href="#SRI" class="xref">[SRI]</a> hash.  <a href="https://hillbrad.github.io/sri-addressable-caching/sri-addressable-caching.html">https://hillbrad.github.io/sri-addressable-caching/sri-addressable-caching.html</a> discusses security risks of that caching proposal.</p>
<p id="rfc.section.B.p.3">This proposal is also related to a proposal to side-load response payloads and validate that content using a conditional HTTP request (<a href="#RFC7232" class="xref">[RFC7232]</a>). That proposal isn&#8217;t written yet, but it&#8217;s sketched in <a href="https://docs.google.com/document/d/e/2PACX-1vSEzJ8PvAkx05YkfOuXoFjC6v8ByQ9Z11SNlP5pMGV8KXufrxkdhrbGmCzfr_NDsS-g-ISCjWOnkQBf/pub">https://docs.google.com/document/d/e/2PACX-1vSEzJ8PvAkx05YkfOuXoFjC6v8ByQ9Z11SNlP5pMGV8KXufrxkdhrbGmCzfr_NDsS-g-ISCjWOnkQBf/pub</a>.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jeffrey Yasskin</span> 
	  <span class="n hidden">
		<span class="family-name">Yasskin</span>
	  </span>
	</span>
	<span class="org vcardline">Google Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jyasskin@chromium.org">jyasskin@chromium.org</a></span>

  </address>
</div>

</body>
</html>
